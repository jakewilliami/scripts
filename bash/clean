#! /bin/bash
#Script for emptying * directories! 

BASH_DIR="/Users/jakeireland/bin/scripts/bash/"


#Clean up
clean-exit() {
    [[ -f ${BASH_DIR}/textcolours.txt ]] && \
    rm /Users/jakeireland/bin/scripts/bash/textcolours.txt
    exit $?
}


# Colours
jq -r 'to_entries|map("\(.key)=\(.value|tostring)")|.[]' ${BASH_DIR}/textcolours.json | sed -e 's/=\([^" >][^ >]*\)/="\1"/g' >> ${BASH_DIR}/textcolours.txt && source ${BASH_DIR}/textcolours.txt


# Help
HELP="${BWHITE}Invalid option.  Use option -h for help.${NORM}"
display_help() {
    echo -e "${BWHITE}Usage: [sudo] empt [option...]${NORM}"
    echo
    echo -e "${ITWHITE}The present script will help to clear deprecated files.  ${ITRED}Omitting option altogether will iteratively delete everything in both Trash and Downloads.${NORM}"
    echo
    echo -e "${BBLUE}\t -t \t${BYELLOW}Interatively ${BRED}deletes everything in ${BBLUE}t${BRED}rash ${BYELLOW}(shared and local).${NORM}"
    echo -e "${BBLUE}\t -d \t${BYELLOW}Interatively ${BRED}deletes everything in ${BBLUE}d${BRED}ownloads folder.${NORM}"
    echo -e "${BBLUE}\t -h \t${BYELLOW}Shows ${BBLUE}h${BYELLOW}elp (present output).${NORM}"
    clean-exit
}


# Options
while getopts ":tdh" OPTION; do
        case $OPTION in
                t)
                    while true; do
                        read -p "${BRED}Are you sure you want to delete everything in your trash?${NORM}" yn
                        case $yn in
                            [Yy]* ) rm -drf ~/Library/Mobile\ Documents/com\~apple\~CloudDocs/.Trash/*
                                    rm -drf ~/.Trash* 
                                    break;;
                            [Nn]* ) exit;;
                            * )     echo "${BYELLOW}Please answer yes or no.${BNORM}";;
                        esac
                    done  
                    ;;

                d)  
                    while true; do
                        read -p "${BRED}Are you sure you want to delete everything in your downloads folder?${NORM}" yn
                        case $yn in
                            [Yy]* ) rm -drf ~/Downloads/* 
                                    break;;
                            [Nn]* ) exit;;
                            * )     echo "${BYELLOW}Please answer yes or no.${BNORM}";;
                        esac
                    done
                    ;;
                h)
                    display_help
                    ;;
                \?)
                    echo -e "${HELP}"
                    ;;
        esac
done


# If no options
if [[ -z $1 ]]
then
    while true; do
                        read -p "${BRED}Are you sure you want to delete everything in your trash and downloads folder?${NORM}" yn
                        case $yn in
                            [Yy]* ) rm -drf ~/Library/Mobile\ Documents/com\~apple\~CloudDocs/.Trash/*
                                    rm -drf ~/.Trash*
                                    rm -drf ~/Downloads/* 
                                    break;;
                            [Nn]* ) exit;;
                            * )     echo "${BYELLOW}Please answer yes or no.${BNORM}";;
                        esac
                    done
fi


# Clean up
clean-exit
