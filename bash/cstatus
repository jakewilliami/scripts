#! /bin/bash

# define bash directory
BASH_DIR="${HOME}/scripts/bash/"

# source required scripts
source ${BASH_DIR}/dependencies/source-dependencies.sh

# get script dependencies
is-command-then-install ruby rbenv ruby-build
gem_install iStats

# Help
display_help() {
    help_start 'cstatus [option...]' 'The present script will tell the user computer status/information given an option.'
    help_commands '-u' '--cpu-util' '1' 'Prints total' 'u' 'tilisation' 'of the CPU as a percentage.'
    help_commands '-s' '--cup-stats' '1' 'Prints CPU' 's' 'tatistic' 'information.'
    help_commands '-a' '--arch' '2' 'Prints the' 'a' 'rchitecture' 'on which the present computer runs.'
    help_help '2'
    clean-exit
}


cpu_utilisation() {
    ps -A -o %cpu | \
    awk '{s+=$1} END {print s "%"}'  # Adds up all processes using cpu
}


cpu_statistics() {
    istats
}


bits() {
    echo -e "${BGREEN}This computer is running on a $(getconf LONG_BIT)-bit architecture.${NORM}"
}


while getopts ":-:auhs" OPTION; do
        case $OPTION in
                -)
                    case $OPTARG in
                        cpu-util)
                            cpu_utilisation ;;
                        cpu-stats)
                            cpu-statistics ;;
                        arch)
                            bits ;;
                        help)
                            display_help ;;
                        *)
                            opt_err ;;
                    esac ;;
                u)
                    cpu_utilisation ;;
                s)
                    cpu_statistics ;;
                a)
                    bits ;;
                h)  
                    display_help ;;
                *)
                    opt_err ;;
        esac
done


if [[ -z $1 ]]
then
    opt_err_none
fi


# Clean up
clean-exit
