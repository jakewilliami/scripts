#! /bin/bash

GIT_LOCATION="/Users/jakeireland/Documents/my_macros/"
LOCAL_DIR="${GIT_LOCATION}../../.config/texstudio/templates/user/"
GIT_DIR="${GIT_LOCATION}tea_templates/"
BASH_DIR="/Users/jakeireland/bin/scripts/bash/"


#Clean up
clean-exit() {
    if [[ -f ${BASH_DIR}/textcolours.txt ]]
    then
        rm /Users/jakeireland/bin/scripts/bash/textcolours.txt
    fi
    exit $?
}


# Colours
jq -r 'to_entries|map("\(.key)=\(.value|tostring)")|.[]' ${BASH_DIR}/textcolours.json | sed -e 's/=\([^" >][^ >]*\)/="\1"/g' >> ${BASH_DIR}/textcolours.txt && source ${BASH_DIR}/textcolours.txt


#Define local variables
REPLACING_TEX="${BYELLOW}Replacing outdated .tex file(s) in git repository.${NORM}"
COMPLETED_TEX="${BGREEN}.tex transfer complete.${NORM}"
REPLACING_JSON="${BYELLOW}Replacing outdated .json file(s) in git repository.${NORM}"
COMPLETED_JSON="${BGREEN}.json transfer complete.${NORM}"
ALL_GOOD_TEX="${BGREEN}Your git repository's templates directory's .tex files are up to date with your local templates directory.${NORM}"
ALL_GOOD_JSON="${BGREEN}Your git repository's templates directory's .json files are up to date with your local templates directory.${NORM}"


DIFFT=false
DIFFJ=false

#Begin script

cd "${GIT_LOCATION}" || clean-exit

#check tex files
for t in "${LOCAL_DIR}"/*.tex; do
   if ! cmp -s "$t" "${GIT_DIR}"/$(basename $t)
   then
        DIFFT=true
        echo -e "${REPLACING_TEX}" 
        cp -fr "$t" "${GIT_DIR}/" && echo -e ${COMPLETED_TEX}
    fi
done

if [ $DIFFT = false ]
then
    echo -e "${ALL_GOOD_TEX}"
fi


for j in "${LOCAL_DIR}"/*.json; do
   if ! cmp -s "$j" "${GIT_DIR}"/$(basename $j)
   then
        DIFFJ=true
        echo -e "${REPLACING_JSON}" 
        cp -fr "$j" "${GIT_DIR}/" && echo -e ${COMPLETED_JSON}
    fi
done

if [ "$DIFFJ" = "false" ]
then
    echo -e "${ALL_GOOD_JSON}"
fi


clean-exit