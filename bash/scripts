#! /bin/bash

BASH_DIR="${HOME}/bin/scripts/bash/"

# Ensure jq is installed
source ${BASH_DIR}/dependencies/jq-dep.sh

# Colours
source ${BASH_DIR}/colours/json-colour-parser.sh

# Brew Install function
source ${BASH_DIR}/dependencies/brew-install-dep.sh

# Satisfy Dependencies
brew_install "${SATISFYING_DEPS}" python3 && \
echo -e "${DEPS_SATISFIED}"

REPLACING1="${BYELLOW}Replacing outdated file in git repository from ~/.bashrc.${NORM}"
COMPLETED1="${BGREEN}.bashrc transfer complete.${NORM}"
REPLACING2="${BYELLOW}Replacing outdated file in git repository from ~/.bash_profile.${NORM}"
COMPLETED2="${BGREEN}.bash_profile transfer complete.${NORM}"

# Help
display_help() {
    echo -e "${BWHITE}Usage: scripts [option...]${NORM}"
    echo
    echo -e "${ITWHITE}The present script will take you to the scripts directory and by default list its content.${NORM}"
    echo
    echo -e "${BBLUE}\t -l | --listless \t${BYELLOW}Supresses ${ULINE}${BBLUE}l${BYELLOW}isting${NORM}${BYELLOW} directory content${NORM}"
    echo -e "${BBLUE}\t -h | --help \t\t${BYELLOW}Shows ${ULINE}${BBLUE}h${BYELLOW}elp${NORM} ${BYELLOW}(present output).${NORM}"
    clean-return
}


opt_err() {
    HELP="${BYELLOW}Invalid option.  Use option -h for help.${NORM}"
    echo -e "${HELP}"
	clean-return
}


opt_l() {
    cd "${DIR}" || clean-return
}


while getopts ":-:lh" OPTION; do
        case $OPTION in
                -)
                    case $OPTARG in
                        listless)
                            opt_l ;;
                        help)
                            display_help ;;
                        *)
                            opt_err ;;
                    esac ;;
                l)
                    opt_l ;;
                h)  
                    display_help ;;
                *)
                    opt_err ;;
        esac
done


GIT_LOCATION="${HOME}/bin/scripts/"
LOCAL_FILE1="${HOME}/.bashrc"
LOCAL_FILE2="${HOME}/.bash_profile"
GIT_DIR="${GIT_LOCATION}/system/"


# List
if [[ -z $1 ]]
then
    cd "${BASH_DIR}/.." || clean-return
    python3 "${BASH_DIR}/../python/ls.py" "${BASH_DIR}/.."
fi


# check if local bashrc matches git one
if cmp -s ${LOCAL_FILE1} ${GIT_DIR}/.bashrc
then
    :
else
    echo -e "${REPLACING1}" && \
    cp "${LOCAL_FILE1}" "${GIT_DIR}" && \
    echo -e "${COMPLETED1}"
fi


# check if local bash_profile matches git one
if cmp -s ${LOCAL_FILE2} ${GIT_DIR}/.bash_profile
then
    :
else
    echo -e "${REPLACING2}" && \
    cp "${LOCAL_FILE2}" "${GIT_DIR}" && \
    echo -e "${COMPLETED2}"
fi


# Clean up
clean-return
